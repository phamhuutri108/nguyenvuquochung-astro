---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection, getEntry } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

type Role = 'production' | 'editor' | 'director' | 'assistant-director';

const roleMeta: Record<Role, { en: string; vi: string; color: string }> = {
  production: { en: 'PRODUCTION', vi: 'SẢN XUẤT', color: '#CC0000' },
  editor: { en: 'EDITOR', vi: 'DỰNG PHIM', color: '#2255DD' },
  director: { en: 'DIRECTOR', vi: 'ĐẠO DIỄN', color: '#22AA44' },
  'assistant-director': { en: 'ASSISTANT DIRECTOR', vi: 'TRỢ LÝ ĐẠO DIỄN', color: '#DD9900' },
};

export async function getStaticPaths() {
  const roles: Role[] = ['production', 'editor', 'director', 'assistant-director'];
  const paths = [];

  for (const role of roles) {
    const projects = await getCollection(role as any);
    for (const project of projects) {
      if (!project.data.draft) {
        paths.push({
          params: { role, slug: project.slug },
          props: { project, role },
        });
      }
    }
  }

  return paths;
}

const { project, role } = Astro.props as {
  project: CollectionEntry<any>;
  role: Role;
};

const meta = roleMeta[role];
const { Content } = await project.render();
---

<BaseLayout
  title={`${project.data.title} — Nguyễn Vũ Quốc Hưng`}
  currentPath={`/projects/${role}/${project.slug}`}
  description={project.data.description}
>
  <article class="project-detail">

    <!-- Back navigation -->
    <nav class="project-detail__nav">
      <a href={`/projects/${role}`} class="project-detail__back">
        <span class="l-en">← {meta.en}</span>
        <span class="l-vi">← {meta.vi}</span>
      </a>
    </nav>

    <!-- Hero image -->
    {project.data.coverImage && (
      <div class="project-detail__hero">
        <img
          src={project.data.coverImage}
          alt={project.data.title}
          class="project-detail__hero-img"
        />
        <div class="project-detail__hero-overlay"></div>
      </div>
    )}

    <!-- Header -->
    <header class="project-detail__header">
      <span class="project-detail__role" style={`color: ${meta.color}`}>
        <span class="l-en">{meta.en}</span>
        <span class="l-vi">{meta.vi}</span>
      </span>
      <h1 class="project-detail__title">
        <span class="l-en">{project.data.title}</span>
        <span class="l-vi">{project.data.titleVi || project.data.title}</span>
      </h1>
      {project.data.year && (
        <span class="project-detail__year">{project.data.year}</span>
      )}
      {(project.data.description || project.data.descriptionVi) && (
        <p class="project-detail__desc">
          <span class="l-en">{project.data.description}</span>
          <span class="l-vi">{project.data.descriptionVi || project.data.description}</span>
        </p>
      )}
    </header>

    <!-- Content -->
    <div class="project-detail__body">
      <Content />
    </div>

  </article>
</BaseLayout>

<style>
.project-detail {
  max-width: 820px;
  margin: 0 auto;
  padding: 4rem 2rem 6rem;
}

.project-detail__nav {
  margin-bottom: 2rem;
}

.project-detail__back {
  font-family: 'Oswald', sans-serif;
  font-size: 0.75rem;
  letter-spacing: 0.2em;
  color: rgba(255,255,255,0.35);
  text-decoration: none;
  transition: color 0.2s;
}

.project-detail__back:hover {
  color: rgba(255,255,255,0.7);
}

.project-detail__hero {
  position: relative;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  margin-bottom: 2.5rem;
}

.project-detail__hero-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.project-detail__hero-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.8) 100%);
}

.project-detail__header {
  margin-bottom: 2.5rem;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding-bottom: 2rem;
}

.project-detail__role {
  display: block;
  font-family: 'Oswald', sans-serif;
  font-size: 0.75rem;
  letter-spacing: 0.25em;
  margin-bottom: 0.75rem;
}

.project-detail__title {
  font-family: 'Barlow Condensed', 'Oswald', sans-serif;
  font-size: clamp(2rem, 5vw, 3.5rem);
  font-weight: 900;
  font-style: italic;
  line-height: 1;
  color: #fff;
  margin-bottom: 0.5rem;
  letter-spacing: 0.02em;
}

.project-detail__year {
  display: inline-block;
  font-family: 'Inter', sans-serif;
  font-size: 0.75rem;
  color: rgba(255,255,255,0.3);
  letter-spacing: 0.1em;
  margin-bottom: 1rem;
}

.project-detail__desc {
  font-family: 'Inter', sans-serif;
  font-size: 1rem;
  line-height: 1.7;
  color: rgba(255,255,255,0.55);
}

/* Markdown content */
.project-detail__body {
  font-family: 'Inter', sans-serif;
  font-size: 0.95rem;
  line-height: 1.85;
  color: rgba(255,255,255,0.6);
}

.project-detail__body h2 {
  font-family: 'Oswald', sans-serif;
  font-size: 1.3rem;
  font-weight: 500;
  letter-spacing: 0.1em;
  color: #fff;
  margin: 2rem 0 1rem;
}

.project-detail__body p {
  margin-bottom: 1.25rem;
}

.project-detail__body a {
  color: var(--color-accent);
  text-decoration: underline;
}

.project-detail__body ul,
.project-detail__body ol {
  padding-left: 1.5rem;
  margin-bottom: 1.25rem;
}

.project-detail__body li {
  margin-bottom: 0.4rem;
}

/* i18n */
[data-lang="en"] .l-vi { display: none; }
[data-lang="vi"] .l-en { display: none; }

@media (max-width: 600px) {
  .project-detail {
    padding: 3rem 1.5rem 4rem;
  }
}
</style>
